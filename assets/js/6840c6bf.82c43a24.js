"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4675],{3905:(e,n,a)=>{a.d(n,{Zo:()=>m,kt:()=>d});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function s(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=t.createContext({}),c=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):s(s({},n),e)),a},m=function(e){var n=c(e.components);return t.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(a),d=r,b=p["".concat(i,".").concat(d)]||p[d]||u[d]||o;return a?t.createElement(b,s(s({ref:n},m),{},{components:a})):t.createElement(b,s({ref:n},m))}));function d(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=p;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<o;c++)s[c]=a[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},1291:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var t=a(7462),r=(a(7294),a(3905));const o={id:"install-kubernetes-yaml",title:"Kubernetes YAML file",slug:"kubernetes-yaml",tags:["install","kube","kubernetes"]},s="Kubernetes YAML File",l={unversionedId:"install/kubernetes/install-kubernetes-yaml",id:"install/kubernetes/install-kubernetes-yaml",title:"Kubernetes YAML file",description:"The following YAML file is the recommended one to use to deploy the coordimap agent in a kubernetes cluster.",source:"@site/docs/install/kubernetes/kube_yaml.mdx",sourceDirName:"install/kubernetes",slug:"/install/kubernetes/kubernetes-yaml",permalink:"/docs/install/kubernetes/kubernetes-yaml",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/install/kubernetes/kube_yaml.mdx",tags:[{label:"install",permalink:"/docs/tags/install"},{label:"kube",permalink:"/docs/tags/kube"},{label:"kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",frontMatter:{id:"install-kubernetes-yaml",title:"Kubernetes YAML file",slug:"kubernetes-yaml",tags:["install","kube","kubernetes"]},sidebar:"tutorialSidebar",previous:{title:"Kubernetes Installation",permalink:"/docs/install/kubernetes/kubernetes-install"},next:{title:"Binaries",permalink:"/docs/install/binaries"}},i={},c=[],m={toc:c};function u(e){let{components:n,...a}=e;return(0,r.kt)("wrapper",(0,t.Z)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"kubernetes-yaml-file"},"Kubernetes YAML File"),(0,r.kt)("p",null,"The following YAML file is the recommended one to use to deploy the coordimap agent in a kubernetes cluster."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: coordimap-agent-deployment-cluster-role\n  namespace: coordimap\nrules:\n  - verbs:\n      - "get"\n      - "list"\n    apiGroups:\n      - ""\n      - "apps"\n      - "batch"\n      - "storage"\n      - "storage.k8s.io"\n      - "extensions"\n      - "networking.k8s.io"\n    resources:\n      - "nodes"\n      - "namespaces"\n      - "pods"\n      - "service"\n      - "secrets"\n      - "endpoints"\n      - "configmaps"\n      - "persistentvolumeclaims"\n      - "persistentvolumes"\n      - "deployments"\n      - "statefulsets"\n      - "daemonsets"\n      - "jobs"\n      - "cronjobs"\n      - "storageclasses"\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: coordimap-agent-rolebinding\n  namespace: coordimap\nsubjects:\n  - kind: User\n    name: system:serviceaccount:coordimap-agent:default\n    apiGroup: rbac.authorization.k8s.io\n    namespace: coordimap\n  - kind: ServiceAccount\n    name: default\n    namespace: coordimap\nroleRef:\n  kind: ClusterRole\n  name: coordimap-agent-deployment-cluster-role\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coordimap-agent-deployment\n  namespace: coordimap\nspec:\n  selector:\n    matchLabels:\n      app: coordimap-agent\n  template:\n    metadata:\n      labels:\n        app: coordimap-agent\n    spec:\n      containers:\n        - name: coordimap-agent\n          image: coordimap/coordimap-agent:latest\n          command:\n            - "/agent"\n          args:\n            - "--debug"\n            - "--config"\n            - "/config.yaml"\n            - "--endpoint"\n            - "https://api.coordimap.com/collector/crawlers/infra"\n          env:\n            - name: API_KEY\n              value: YYY\n          volumeMounts:\n            - mountPath: /config.yaml\n              subPath: config.yaml\n              name: coordimap-config-file\n              readOnly: True\n          resources:\n            requests:\n              memory: "150M"\n              cpu: "500m"\n              ephemeral-storage: "15Mi"\n            limits:\n              memory: "150M"\n              cpu: "500m"\n              ephemeral-storage: "15Mi"\n      volumes:\n        - name: coordimap-config-file\n          configMap:\n            name: coordimap-config\n            items:\n              - key: config.yaml\n                path: config.yaml\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coordimap-config\n  namespace: coordimap\ndata:\n  config.yaml: |-\n    coordimap:\n      api_key: ${API_KEY}\n      data_sources:\n        - type: aws\n          name: aws1\n          desc: desc1\n          config:\n          - name: policy_config\n            value: "true"\n          - name: access_key_id\n            value: ${ACCESS_KEY_ID}\n          - name: secret_access_key\n            value: ${SECRET_ACCSS_KEY}\n          - name: crawl_interval\n            value: 30s\n        - type: postgres\n          name: post1\n          desc: desc1\n          config:\n            - name: db_name\n              value: dbname1\n            - name: db_host\n              value: host1\n            - name: db_user\n              value: user1\n            - name: db_pass\n              value: pass1\n            - name: crawl_interval\n              value: 30s\n        - type: kubernetes\n          name: kube1\n          desc: desc1\n          config:\n          - name: in_cluster\n            value: "false"\n          - name: config_file\n            value: /.kube/config\n          - name: crawl_interval\n            value: 30s\n        - type: aws_flow_logs\n          name: flowlog1\n          desc: desc1\n          config:\n          - name: log_format\n            value: all\n          - name: log_type\n            value: S3\n          - name: account_id\n            value: 123456789\n          - name: bucket_name\n            value: pe-flowlogs\n          - name: region\n            value: eu-central-1\n          - name: access_key_id\n            value: ${ACCESS_KEY_ID}\n          - name: secret_access_key\n            value: ${SECRET_ACCSS_KEY}\n          - name: crawl_interval\n            value: 30s\n')))}u.isMDXComponent=!0}}]);